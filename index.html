<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Digitales Cashflow‚ÄëTool</title>
  <style>
    :root {
      --bg: #f5f7fa;
      --surface: #ffffff;
      --primary: #2a9d8f;
      --secondary: #264653;
      --accent: #e9c46a;
      --text: #333333;
      --border: #dddddd;
      --danger: #e76f51;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      padding: 0.5rem;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      transition: transform 0.3s ease;
    }input,
    select {
      font-size: 1rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.5rem;
      transition: box-shadow 0.3s ease, border-color 0.3s ease;
      width: 100%;
    }

    input:focus,
    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 5px rgba(42, 157, 143, 0.5);
      outline: none;
    }

    .profile-selector-container {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      z-index: 10;
    }

    .profile-selection {
      background: var(--surface);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 0.5rem;
      display: flex;
      align-items: center;
    }

    .profile-selection select {
      margin-left: 0.5rem;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      flex: 1;
      overflow: auto;
      padding-top: 2.5rem;
    }

    .sheet {
      flex: 1 1 320px;
      background: var(--surface);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      height: 100%;
      overflow-y: auto;
      max-height: calc(100vh - 3.5rem);
    }

    .sheet:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    h2 {
      color: var(--primary);
      margin-bottom: 0.75rem;
      font-size: 1.2rem;
    }

    section+section {
      margin-top: 1rem;
    }    label {
      display: block;
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }
    
    .label {
      white-space: nowrap;
      padding-right: 0.2rem;
    }.grid3 {
      display: grid;
      grid-template-columns: auto 1fr 1fr;
      grid-auto-flow: dense;
      gap: 0.2rem;
      column-gap: 0.5rem;
      margin: 0.5rem 0;
      font-size: 0.95rem;
      align-items: center;
    }
    
    .full-span {
      grid-column: 2 / span 2;
    }    .grid4 {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 0.2rem;
      column-gap: 0.5rem;
      margin: 0.5rem 0;
      font-size: 0.95rem;
      align-items: center;
    }    .liability-control {
      display: flex;
      gap: 0.3rem;
      align-items: center;
    }
      .asset-control {
      display: flex;
      gap: 0.3rem;
      align-items: center;
      grid-column: 2 / span 2;
    }

    .bank-loan-control {
      display: flex;
      gap: 0.4rem;
    }

    .bank-controls {
      display: flex;
      gap: 0.2rem;
    }

    .bank-controls button {
      padding: 0.4rem;
      min-width: 50px;
      font-size: 0.8rem;
    }

    .summary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #ffffff;
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
    }

    .summary label {
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.4rem;
    }

    .balance {
      font-weight: bold;
      text-align: center;
      margin-bottom: 0.75rem;
      font-size: 1.1rem;
    }

    #entries li {
      display: flex;
      margin-bottom: 0.4rem;
      opacity: 0;
      animation: fadeIn 0.4s ease-out forwards;
    }

    #entries input {
      flex: 1;
      padding: 0.4rem;
      border-radius: 4px;
      font-size: 0.95rem;
    }

    button {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.4rem 0.6rem;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s;
      font-size: 0.9rem;
    }

    button:hover:not(:disabled) {
      background-color: #238a7e;
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
    }

    button:disabled {
      background-color: #cccccc;
      color: #888888;
      cursor: not-allowed;
    }    button.btn-disabled {
      opacity: 0.7;
    }
    
    /* Popup styles */
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    
    .popup-content {
      background-color: var(--surface);
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      padding: 1.5rem;
      width: 90%;
      max-width: 400px;
    }
    
    .popup-content h3 {
      color: var(--primary);
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .popup-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 0.8rem;
      margin-bottom: 1.5rem;
      align-items: center;
    }
    
    .popup-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 0.8rem;
    }    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-3px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      body.taskbar-hidden {
        transform: translateY(-70px);
      }
      
      .mobile-handle {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 10px;
        background-color: var(--primary);
        opacity: 0.3;
        z-index: 50;
        border-radius: 0 0 4px 4px;
        display: none;
      }
      
      body.taskbar-hidden .mobile-handle {
        display: block;
      }
      
      .container {
        padding-bottom: 20px; /* Extra space at bottom on mobile */
      }
    }
  </style>
</head>

<body>
  <div class="mobile-handle" id="mobile-handle"></div>
  <div class="profile-selector-container">
    <div class="profile-selection">
      <label for="profile-selector">Profil:</label>
      <select id="profile-selector">
        <option value="debug-anwalt">üêû Debug Anwalt</option>
        <option value="anwalt">‚öñÔ∏è Anwalt</option>
        <option value="arzt">ü©∫ Arzt</option>
        <option value="hausmeister">üè† Hausmeister</option>
        <option value="ingenieur">üë∑ Ingenieur</option>
        <option value="krankenschwester">üè• Krankenschwester</option>
        <option value="lehrer">üìö Lehrer</option>
        <option value="lkw-fahrer">üöö LKW‚ÄëFahrer</option>
        <option value="manager">üíº Manager</option>
        <option value="mechaniker">üîß Mechaniker</option>
        <option value="pilot">‚úàÔ∏è Pilot</option>
        <option value="polizist">üëÆ Polizist</option>
        <option value="sekretaer">üóÇÔ∏è Sekret√§r</option>
      </select>
    </div>
  </div>  <!-- Popup f√ºr Edelmetalle Kauf -->
  <div id="metals-popup" class="popup-overlay">
    <div class="popup-content">
      <h3>Edelmetalle kaufen</h3>
      <div class="popup-grid">
        <label>Kaufart:</label>
        <select id="metals-buy-type">
          <option value="total">Gesamtpreis</option>
          <option value="per-coin">Preis pro M√ºnze</option>
        </select>
        
        <label>Anzahl M√ºnzen:</label>
        <input id="metals-coins" type="number" min="1" value="1">
        
        <label>Preis:</label>
        <input id="metals-price" type="number" min="0" value="0">
          <div id="metals-total-container" style="display: none">
          <label>Gesamtpreis:</label>
          <span id="metals-total-price">0 ‚Ç¨</span>
        </div>
      </div>
      
      <div class="popup-buttons">
        <button id="metals-buy-confirm">Kaufen</button>
        <button id="metals-buy-cancel">Abbrechen</button>      </div>
    </div>
  </div>
  
  <!-- Popup f√ºr Edelmetalle Verkauf -->
  <div id="metals-sell-popup" class="popup-overlay">
    <div class="popup-content">
      <h3>Edelmetalle verkaufen</h3>
      <div class="popup-grid">
        <label>Verkaufsart:</label>
        <select id="metals-sell-type">
          <option value="total">Gesamtpreis</option>
          <option value="per-coin">Preis pro M√ºnze</option>
        </select>
        
        <label>Anzahl M√ºnzen:</label>
        <input id="metals-sell-coins" type="number" min="1" value="1">
        
        <label>Preis:</label>
        <input id="metals-sell-price" type="number" min="0" value="0">
        
        <div id="metals-sell-total-container" style="display: none">
          <label>Gesamterl√∂s:</label>
          <span id="metals-sell-total-price">0 ‚Ç¨</span>
        </div>
        
        <label>Verf√ºgbare M√ºnzen:</label>
        <span id="metals-available">0</span>
      </div>
      
      <div class="popup-buttons">
        <button id="metals-sell-confirm">Verkaufen</button>
        <button id="metals-sell-cancel">Abbrechen</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="sheet">      <section>
        <h2>1) Einkommen</h2>
        <div class="grid4">
          <div class="label">Gehalt:</div>
          <input id="input-income-salary" type="number" readonly>
          <div class="label">Immobilien/Unternehmen:</div>
          <input id="input-income-property" type="number" readonly>
        </div>
      </section>
      <section>
        <h2>2) Ausgaben</h2>
        <div class="grid4">
          <div class="label">Steuern:</div>
          <input id="input-expenses-taxes" type="number" readonly>
          <div class="label">Eigenheim‚ÄëHypothek:</div>
          <input id="input-expenses-mortgage" type="number" readonly>
          <div class="label">BAf√∂G Darlehenszahlung:</div>
          <input id="input-expenses-bafog" type="number" readonly>
          <div class="label">Autokredit‚ÄëZahlung:</div>
          <input id="input-expenses-autoloan" type="number" readonly>
          <div class="label">Kreditkarten‚ÄëZahlung:</div>
          <input id="input-expenses-cc" type="number" readonly>
          <div class="label">Bankkredit‚ÄëZahlung:</div>
          <input id="input-expenses-bank" type="number" readonly>
        </div>
      </section><section>
        <h2>3) Verm√∂genswerte</h2>
        <div class="grid3">          <div class="label">Edelmetalle etc.:</div>
          <div class="asset-control">
            <input id="input-asset-metals" type="number" readonly class="full-span">
            <button id="btn-buy-metals">Kaufen</button>
            <button id="btn-sell-metals" disabled>Verkaufen</button>
          </div>
          <div class="label">Aktien/Fonds/CDs:</div>
          <div class="asset-control">
            <input id="input-asset-stocks-qty" type="number" readonly>
            <input id="input-asset-stocks-cost" type="number" readonly>
            <button id="btn-buy-stocks">Kaufen</button>
            <button id="btn-sell-stocks" disabled>Verkaufen</button>
          </div>
          <div class="label">Immobilien/Unternehmen:</div>
          <div class="asset-control">
            <input id="input-asset-property-down" type="number" readonly>
            <input id="input-asset-property-cost" type="number" readonly>
            <button id="btn-buy-property">Kaufen</button>
            <button id="btn-sell-property" disabled>Verkaufen</button>
          </div>
        </div>
      </section>
      <section>
        <h2>4) Verbindlichkeiten</h2>
        <div class="grid4">
          <div class="label">Eigenheim‚ÄëHypothek:</div>
          <div class="liability-control">
            <input id="input-liability-mortgage" type="number" readonly>
            <button id="btn-pay-mortgage">Abzahlen</button>
          </div>
          <div class="label">BAf√∂G Darlehen:</div>
          <div class="liability-control">
            <input id="input-liability-bafog" type="number" readonly>
            <button id="btn-pay-bafog">Abzahlen</button>
          </div>
          <div class="label">Autokredit:</div>
          <div class="liability-control">
            <input id="input-liability-autoloan" type="number" readonly>
            <button id="btn-pay-autoloan">Abzahlen</button>
          </div>
          <div class="label">Kreditkartenschulden:</div>
          <div class="liability-control">
            <input id="input-liability-cc" type="number" readonly>
            <button id="btn-pay-cc">Abzahlen</button>
          </div>
          <div class="label">Bankkredit:</div>
          <div class="liability-control bank-loan-control">
            <input id="input-liability-bank" type="number" readonly>
            <div class="bank-controls">
              <button id="btn-pay-bank-1000">-1000</button>
              <button id="btn-take-bank-1000">+1000</button>
            </div>
          </div>
        </div>
      </section>
    </div>
    <div class="sheet bargeldkonto">
      <h2>Bargeldkonto¬†‚Äì¬†<span id="job-display"></span></h2>
      <div class="summary">
        <label>Gehalt:<span id="sum-salary">0¬†‚Ç¨</span></label>
        <label>Passives Einkommen:<span id="sum-passive">0¬†‚Ç¨</span></label>
        <label>Gesamtes Einkommen:<span id="sum-total-income">0¬†‚Ç¨</span></label>
        <label>Gesamte Ausgaben:<span id="sum-total-expenses">0¬†‚Ç¨</span></label>
        <label>Cashflow:<span id="sum-cashflow">0¬†‚Ç¨</span></label>
      </div>
      <div class="balance">Aktueller Kontostand: <span id="current-balance">0,00</span>¬†‚Ç¨</div>
      <ul id="entries"></ul>
    </div>
  </div>
  <script>
    const profilesData = {
      "debug-anwalt": { bal: [50000, 100000], inc: 7500, exp: 5100, ob: [[115000, 1100], [78000, 300], [11000, 200], [7000, 200], [0, 0]], taxes: 3300 },
      anwalt: { bal: [2000, 2400], inc: 7500, exp: 5100, ob: [[115000, 1100], [78000, 300], [11000, 200], [7000, 200], [0, 0]], taxes: 3300 },
      arzt: { bal: [3500, 4900], inc: 13200, exp: 8300, ob: [[202000, 1900], [150000, 700], [19000, 300], [10000, 200], [0, 0]], taxes: 5700 },
      hausmeister: { bal: [600, 600], inc: 1600, exp: 1000, ob: [[20000, 200], [0, 0], [4000, 100], [3000, 100], [0, 0]], taxes: 600 },
      ingenieur: { bal: [400, 1700], inc: 4900, exp: 3200, ob: [[75000, 700], [12000, 100], [7000, 200], [5000, 200], [0, 0]], taxes: 2000 },
      krankenschwester: { bal: [500, 1100], inc: 3100, exp: 2000, ob: [[47000, 400], [6000, 100], [5000, 100], [4000, 200], [0, 0]], taxes: 1200 },
      lehrer: { bal: [400, 1200], inc: 3300, exp: 2100, ob: [[50000, 500], [12000, 100], [5000, 100], [4000, 200], [0, 0]], taxes: 1200 },
      "lkw-fahrer": { bal: [800, 800], inc: 2500, exp: 1700, ob: [[38000, 400], [0, 0], [4000, 100], [3000, 100], [0, 0]], taxes: 1100 },
      manager: { bal: [400, 1600], inc: 4600, exp: 3000, ob: [[75000, 700], [12000, 100], [6000, 100], [4000, 200], [0, 0]], taxes: 1900 },
      mechaniker: { bal: [700, 700], inc: 2000, exp: 1300, ob: [[31000, 300], [0, 0], [3000, 100], [3000, 100], [0, 0]], taxes: 900 },
      pilot: { bal: [2500, 3500], inc: 9500, exp: 6000, ob: [[90000, 1000], [0, 0], [15000, 300], [22000, 700], [0, 0]], taxes: 4000 },
      polizist: { bal: [500, 1100], inc: 3000, exp: 1900, ob: [[46000, 400], [0, 0], [5000, 100], [3000, 100], [0, 0]], taxes: 300 },
      sekretaer: { bal: [700, 800], inc: 2500, exp: 1700, ob: [[38000, 400], [0, 0], [4000, 100], [3000, 100], [0, 0]], taxes: 100 }
    };
    let balanceArray = [], baseIncome = 0, baseExpenses = 0, obligations = [];
    let initialBalance = 0, runningBalance = 0;
    const sel = document.getElementById('profile-selector');

    function generateArray() {
      const arr = [];
      let j = 0;
      while (j < balanceArray.length || arr.length % 2 === 0) {
        let i = arr.length;
        if (i < balanceArray.length) {
          arr.push(balanceArray[i]); j++;
        } else if (i % 2 === 0) {
          arr.push(arr[i - 1] + arr[i - 2]);
        } else {
          arr.push(balanceArray[j]); j++;
        }
      }
      return arr;
    } function renderBaseEntries() {
      const ul = document.getElementById('entries');
      ul.innerHTML = '';
      const arr = generateArray();
      // Erstes Element (der alte Kontostand) √ºberspringen, und den letzten Wert als initialBalance verwenden
      initialBalance = arr.length > 1 ? arr[arr.length - 1] : 0;
      runningBalance = initialBalance;        // Schleife beginnt bei Index 1, um den ersten Wert zu √ºberspringen
      for (let i = 1; i < arr.length; i++) {
        const num = arr[i];
        const li = document.createElement('li');
        const inp = document.createElement('input');
        // Input als Text statt als Zahl anzeigen, um das Vorzeichen hinzuzuf√ºgen
        inp.type = 'text';
        inp.readOnly = true;
        // Vorzeichen f√ºr den Wert hinzuf√ºgen (+ oder -)
        inp.value = (num >= 0 ? '+' : '-') + Math.abs(num);

        // Rote Farbe f√ºr negative Werte
        if (num < 0) {
          inp.style.color = 'var(--danger)';
        }

        li.append(inp);
        ul.append(li);
      }

      // Display-Aktualisierung und ein neues leeres Eingabefeld f√ºr weitere Eintr√§ge
      updateDisplayBalance();
      addEntry();
    }

    function addEntry() {
      const ul = document.getElementById('entries');
      const li = document.createElement('li');
      const inp = document.createElement('input');
      inp.type = 'number'; inp.placeholder = '‚Ç¨';
      inp.addEventListener('keydown', e => {
        if (e.key === 'Enter') { e.preventDefault(); finalizeEntry(inp); }
      });
      li.append(inp); ul.append(li); inp.focus();
    } function finalizeEntry(inp) {
      const val = parseFloat(inp.value) || 0;
      runningBalance += val;
      inp.readOnly = true;
      inp.type = 'text';
      inp.value = (val >= 0 ? '+' : '') + Math.abs(val);

      // Nach manueller Eingabe setzen wir eine globale Flag, damit updateBankEntryInList wei√ü,
      // dass es einen neuen Eintrag erstellen soll
      window.lastActionWasManualEntry = true;

      const sumLi = document.createElement('li');
      const sumInp = document.createElement('input');
      sumInp.type = 'text';
      sumInp.readOnly = true;
      // Vorzeichen f√ºr Kontostand hinzuf√ºgen
      sumInp.value = (runningBalance >= 0 ? '+' : '-') + Math.abs(runningBalance);
      sumInp.style.background = '#eee';

      // Rote Farbe f√ºr negative Kontost√§nde
      if (runningBalance < 0) {
        sumInp.style.color = 'var(--danger)';
      }

      sumLi.append(sumInp);
      inp.parentNode.after(sumLi);

      updateDisplayBalance();
      addEntry();
    } function updateDisplayBalance() {
      // Vorzeichen f√ºr aktuellen Kontostand immer anzeigen
      const prefix = runningBalance >= 0 ? '+' : '-';
      const currentBalanceEl = document.getElementById('current-balance');

      // Text mit Vorzeichen setzen
      currentBalanceEl.textContent = prefix + Math.abs(runningBalance).toFixed(2).replace('.', ',');      // Farbe anpassen - rot bei negativen Werten
      currentBalanceEl.style.color = runningBalance < 0 ? 'var(--danger)' : 'inherit';

      updatePayButtonStates();
      updateSellButtonStates();
    } function updateSummary() {
      const salary = baseIncome;
      const passive = (+document.getElementById('input-income-property').value || 0);
      const totalInc = salary + passive;
      const totalExp =
        (+document.getElementById('input-expenses-taxes').value || 0) +
        (+document.getElementById('input-expenses-mortgage').value || 0) +
        (+document.getElementById('input-expenses-bafog').value || 0) +
        (+document.getElementById('input-expenses-autoloan').value || 0) +
        (+document.getElementById('input-expenses-cc').value || 0) +
        (+document.getElementById('input-expenses-bank').value || 0);
      document.getElementById('sum-salary').textContent = salary + ' ‚Ç¨';
      document.getElementById('sum-passive').textContent = passive + ' ‚Ç¨';
      document.getElementById('sum-total-income').textContent = totalInc + ' ‚Ç¨';
      document.getElementById('sum-total-expenses').textContent = totalExp + ' ‚Ç¨';
      document.getElementById('sum-cashflow').textContent = (totalInc - totalExp) + ' ‚Ç¨';
    } function setupPayButtons() {
      ['mortgage', 'bafog', 'autoloan', 'cc'].forEach(type => {
        const btn = document.getElementById(`btn-pay-${type}`);
        btn.addEventListener('click', () => {
          const liInput = document.getElementById(`input-liability-${type}`);
          const expInput = document.getElementById(`input-expenses-${type}`);
          const amount = parseFloat(liInput.value) || 0;
          if (runningBalance >= amount && amount > 0) {
            runningBalance -= amount;
            liInput.value = 0;
            expInput.value = 0;
            btn.disabled = true;

            // Eintrag f√ºr die R√ºckzahlung der Verbindlichkeit im Bargeldkonto hinzuf√ºgen
            addLiabilityPaymentToEntries(type, amount);

            updateDisplayBalance();
            updateSummary();
          }
        });
      });
    }

    // Funktion zum Hinzuf√ºgen eines Eintrags f√ºr die R√ºckzahlung einer Verbindlichkeit zum Bargeldkonto
    function addLiabilityPaymentToEntries(type, amount) {
      const ul = document.getElementById('entries');
      const entriesChildren = Array.from(ul.children);
      const lastEntryIndex = entriesChildren.length - 1;

      // Finden des letzten leeren Eingabefelds (f√ºr neue Eintr√§ge)
      const isLastEntryEmpty = lastEntryIndex >= 0 &&
        entriesChildren[lastEntryIndex].querySelector('input').type === 'number';

      const insertBeforeElement = isLastEntryEmpty ? entriesChildren[lastEntryIndex] : null;

      // Erstellen eines Eintrags f√ºr die Verbindlichkeitsr√ºckzahlung
      const li = document.createElement('li');
      const inp = document.createElement('input');
      inp.type = 'text';
      inp.readOnly = true;

      // Negativer Betrag (Geld wird ausgegeben)
      inp.value = '-' + Math.abs(amount);
      inp.style.color = 'var(--danger)';

      // Typ der Verbindlichkeit als Beschreibung im Datensatz speichern
      inp.dataset.liabilityType = type;

      // Je nach Verbindlichkeitstyp einen benutzerfreundlichen Text hinzuf√ºgen
      const liabilityNames = {
        'mortgage': 'Hypothek',
        'bafog': 'BAf√∂G Darlehen',
        'autoloan': 'Autokredit',
        'cc': 'Kreditkarte'
      };

      inp.title = liabilityNames[type] + ' vollst√§ndig abgezahlt';

      li.append(inp);

      if (insertBeforeElement) {
        // Einf√ºgen vor dem leeren Eingabefeld
        ul.insertBefore(li, insertBeforeElement);
      } else {
        // Anf√ºgen am Ende, wenn kein leeres Eingabefeld vorhanden ist
        ul.appendChild(li);
      }

      // Aktualisiere den Kontostand-Eintrag
      const sumLi = document.createElement('li');
      const sumInp = document.createElement('input');
      sumInp.type = 'text';
      sumInp.readOnly = true;
      sumInp.value = (runningBalance >= 0 ? '+' : '-') + Math.abs(runningBalance);
      sumInp.style.background = '#eee';

      if (runningBalance < 0) {
        sumInp.style.color = 'var(--danger)';
      }

      sumLi.append(sumInp);

      if (insertBeforeElement) {
        // Einf√ºgen nach dem Verbindlichkeits-Eintrag und vor dem leeren Eingabefeld
        ul.insertBefore(sumLi, insertBeforeElement);
      } else {
        // Anf√ºgen am Ende
        ul.appendChild(sumLi);
      }

      // Nach Bezahlung einer Verbindlichkeit Flag setzen, damit updateBankEntryInList wei√ü,
      // dass es einen neuen Eintrag erstellen soll f√ºr den n√§chsten Bankkredit
      window.lastActionWasManualEntry = true;
    }
    function updatePayButtonStates() {
      ['mortgage', 'bafog', 'autoloan', 'cc'].forEach(type => {
        const btn = document.getElementById(`btn-pay-${type}`);
        const liInput = document.getElementById(`input-liability-${type}`);
        const amount = parseFloat(liInput.value) || 0;

        // Deaktiviere Knopf wenn Verbindlichkeit 0 ist oder nicht genug Guthaben vorhanden
        btn.disabled = amount <= 0 || runningBalance < amount;

        // Visuelles Feedback zum Knopfstatus
        if (btn.disabled) {
          btn.classList.add('btn-disabled');
          btn.title = amount <= 0 ? 'Keine Verbindlichkeit' : 'Nicht gen√ºgend Guthaben';
        } else {
          btn.classList.remove('btn-disabled');
          btn.title = 'Verbindlichkeit vollst√§ndig abzahlen';
        }
      });

      // Bankkredit-Knopf zum Abbezahlen
      const btnPayBank = document.getElementById('btn-pay-bank-1000');
      const bankInput = document.getElementById('input-liability-bank');
      const bankAmount = parseFloat(bankInput.value) || 0;

      btnPayBank.disabled = bankAmount < 1000 || runningBalance < 1000;
      if (btnPayBank.disabled) {
        btnPayBank.classList.add('btn-disabled');
        btnPayBank.title = bankAmount < 1000 ? 'Kredit zu niedrig f√ºr Teilzahlung' : 'Nicht gen√ºgend Guthaben';
      } else {
        btnPayBank.classList.remove('btn-disabled');
        btnPayBank.title = '1000 ‚Ç¨ vom Bankkredit abzahlen';
      }
    } function loadData(profile) {
      const data = profilesData[profile] || profilesData['anwalt'];
      balanceArray = data.bal;
      baseIncome = data.inc; baseExpenses = data.exp;
      obligations = data.ob;
      document.getElementById('input-income-salary').value = baseIncome;
      document.getElementById('input-income-property').value = 0;
      document.getElementById('input-expenses-taxes').value = data.taxes;
      document.getElementById('input-expenses-mortgage').value = obligations[0][1];
      document.getElementById('input-expenses-bafog').value = obligations[1][1];
      document.getElementById('input-expenses-autoloan').value = obligations[2][1];
      document.getElementById('input-expenses-cc').value = obligations[3][1];

      // Bankkredit-Zinszahlung (10% der Schulden)
      const bankLoanAmount = obligations[4][0];
      const bankLoanPayment = Math.round(bankLoanAmount * 0.1);
      document.getElementById('input-expenses-bank').value = bankLoanPayment;

      // Verbindlichkeiten ausf√ºllen (erster Wert aus jedem ob-Tupel)
      document.getElementById('input-liability-mortgage').value = obligations[0][0];
      document.getElementById('input-liability-bafog').value = obligations[1][0];
      document.getElementById('input-liability-autoloan').value = obligations[2][0];
      document.getElementById('input-liability-cc').value = obligations[3][0]; document.getElementById('input-liability-bank').value = bankLoanAmount;

      document.getElementById('job-display').textContent = sel.options[sel.selectedIndex].text;
      document.getElementById('input-income-property').addEventListener('input', updateSummary);      updateSummary();
      renderBaseEntries();
      updatePayButtonStates();
      updateSellButtonStates();
    } document.addEventListener('DOMContentLoaded', () => {
      sel.addEventListener('change', () => loadData(sel.value));
      loadData(sel.value);
      // addEntry() wird nicht mehr hier aufgerufen, da es bereits in renderBaseEntries() aufgerufen wird
      setupPayButtons();
      setupBankLoanButtons();
      setupBuyButtons();
      setupSellButtons();
    });
      function setupBuyButtons() {
      // Edelmetalle Kauf-Button
      document.getElementById('btn-buy-metals').addEventListener('click', () => {
        showMetalsPopup();
      });
      
      // Aktien Kauf-Button (noch ohne Funktion)
      document.getElementById('btn-buy-stocks').addEventListener('click', () => {
        // Functionality to be implemented
      });
      
      // Immobilien Kauf-Button (noch ohne Funktion)
      document.getElementById('btn-buy-property').addEventListener('click', () => {
        // Functionality to be implemented
      });
      
      // Setup f√ºr das Edelmetalle-Popup
      setupMetalsPopup();
    }
    
    function setupMetalsPopup() {
      const popup = document.getElementById('metals-popup');
      const buyTypeSelect = document.getElementById('metals-buy-type');
      const coinsInput = document.getElementById('metals-coins');
      const priceInput = document.getElementById('metals-price');
      const totalContainer = document.getElementById('metals-total-container');
      const totalPrice = document.getElementById('metals-total-price');
      const confirmBtn = document.getElementById('metals-buy-confirm');
      const cancelBtn = document.getElementById('metals-buy-cancel');
      
      // Kaufart-Wechsel
      buyTypeSelect.addEventListener('change', updateMetalsPriceCalculation);
      
      // Input-√Ñnderungen
      coinsInput.addEventListener('input', updateMetalsPriceCalculation);
      priceInput.addEventListener('input', updateMetalsPriceCalculation);
      
      // Buttons
      confirmBtn.addEventListener('click', () => {
        const coins = parseInt(coinsInput.value) || 0;
        let price;
        
        if (buyTypeSelect.value === 'total') {
          price = parseFloat(priceInput.value) || 0;
        } else {
          price = (parseFloat(priceInput.value) || 0) * coins;
        }
        
        if (coins > 0 && price > 0 && runningBalance >= price) {
          // Betrag vom Kontostand abziehen
          runningBalance -= price;
            // Anzahl der M√ºnzen zu den Edelmetallen hinzuf√ºgen
          const currentMetals = parseInt(document.getElementById('input-asset-metals').value) || 0;
          document.getElementById('input-asset-metals').value = currentMetals + coins;
          
          // Kontostandanzeige aktualisieren
          addMetalsPurchaseToEntries(coins, price);
          updateDisplayBalance();
          updateSellButtonStates();
          
          // Popup schlie√üen
          hideMetalsPopup();
        } else {
          // Fehlermeldung bei unzureichendem Guthaben oder ung√ºltigen Werten
          if (runningBalance < price) {
            alert('Nicht gen√ºgend Guthaben f√ºr diesen Kauf!');
          } else {
            alert('Bitte geben Sie g√ºltige Werte ein!');
          }
        }
      });
      
      cancelBtn.addEventListener('click', hideMetalsPopup);
      
      // Klick au√üerhalb des Popups schlie√üt es
      popup.addEventListener('click', (e) => {
        if (e.target === popup) {
          hideMetalsPopup();
        }
      });
    }
    
    function updateMetalsPriceCalculation() {
      const buyTypeSelect = document.getElementById('metals-buy-type');
      const coinsInput = document.getElementById('metals-coins');
      const priceInput = document.getElementById('metals-price');
      const totalContainer = document.getElementById('metals-total-container');
      const totalPrice = document.getElementById('metals-total-price');
      
      const coins = parseInt(coinsInput.value) || 0;
      const inputPrice = parseFloat(priceInput.value) || 0;
      
      if (buyTypeSelect.value === 'total') {
        // Gesamtpreis ausgew√§hlt
        priceInput.placeholder = 'Gesamtpreis';
        totalContainer.style.display = 'none';      } else {
        // Preis pro M√ºnze ausgew√§hlt
        priceInput.placeholder = 'Preis pro M√ºnze';
        totalContainer.style.display = 'contents';
        totalPrice.textContent = (inputPrice * coins).toFixed(2) + " ‚Ç¨";
      }
    }
    
    function showMetalsPopup() {
      // Popup zur√ºcksetzen und anzeigen
      document.getElementById('metals-buy-type').value = 'total';
      document.getElementById('metals-coins').value = '1';
      document.getElementById('metals-price').value = '';
      document.getElementById('metals-price').placeholder = 'Gesamtpreis';
      document.getElementById('metals-total-container').style.display = 'none';
      
      const popup = document.getElementById('metals-popup');
      popup.style.display = 'flex';
    }
    
    function hideMetalsPopup() {
      document.getElementById('metals-popup').style.display = 'none';
    }
    
    function addMetalsPurchaseToEntries(coins, price) {
      const ul = document.getElementById('entries');
      const entriesChildren = Array.from(ul.children);
      const lastEntryIndex = entriesChildren.length - 1;
      
      // Pr√ºfen, ob das letzte Element ein leeres Eingabefeld ist
      const isLastEntryEmpty = lastEntryIndex >= 0 && 
                             entriesChildren[lastEntryIndex].querySelector('input').type === 'number';
      
      const insertBeforeElement = isLastEntryEmpty ? entriesChildren[lastEntryIndex] : null;
      
      // Eintrag f√ºr den Edelmetallkauf erstellen
      const li = document.createElement('li');
      const inp = document.createElement('input');
      inp.type = 'text';
      inp.readOnly = true;
      inp.value = '-' + price.toFixed(2);
      inp.style.color = 'var(--danger)';
      inp.title = `${coins} Edelmetall-M√ºnze${coins > 1 ? 'n' : ''} gekauft`;
      
      li.append(inp);
      
      if (insertBeforeElement) {
        ul.insertBefore(li, insertBeforeElement);
      } else {
        ul.appendChild(li);
      }
      
      // Aktualisierte Kontostandsanzeige
      const sumLi = document.createElement('li');
      const sumInp = document.createElement('input');
      sumInp.type = 'text';
      sumInp.readOnly = true;
      sumInp.value = (runningBalance >= 0 ? '+' : '-') + Math.abs(runningBalance).toFixed(2);
      sumInp.style.background = '#eee';
      
      if (runningBalance < 0) {
        sumInp.style.color = 'var(--danger)';
      }
      
      sumLi.append(sumInp);
      
      if (insertBeforeElement) {
        ul.insertBefore(sumLi, insertBeforeElement);
      } else {
        ul.appendChild(sumLi);
      }
        // Globale Flag setzen (f√ºr die Bank-Logik)
      window.lastActionWasManualEntry = true;
    }
    
    // Funktion zum Aktualisieren der "Verkaufen"-Buttons
    function updateSellButtonStates() {
      // Edelmetalle
      const metalsAmount = parseInt(document.getElementById('input-asset-metals').value) || 0;
      const btnSellMetals = document.getElementById('btn-sell-metals');
      btnSellMetals.disabled = metalsAmount <= 0;
      if (btnSellMetals.disabled) {
        btnSellMetals.classList.add('btn-disabled');
        btnSellMetals.title = 'Keine Edelmetalle zum Verkaufen vorhanden';
      } else {
        btnSellMetals.classList.remove('btn-disabled');
        btnSellMetals.title = 'Edelmetalle verkaufen';
      }
      
      // Aktien
      const stocksQty = parseInt(document.getElementById('input-asset-stocks-qty').value) || 0;
      const btnSellStocks = document.getElementById('btn-sell-stocks');
      btnSellStocks.disabled = stocksQty <= 0;
      if (btnSellStocks.disabled) {
        btnSellStocks.classList.add('btn-disabled');
        btnSellStocks.title = 'Keine Aktien zum Verkaufen vorhanden';
      } else {
        btnSellStocks.classList.remove('btn-disabled');
        btnSellStocks.title = 'Aktien verkaufen';
      }
      
      // Immobilien
      const propertyDown = parseInt(document.getElementById('input-asset-property-down').value) || 0;
      const btnSellProperty = document.getElementById('btn-sell-property');
      btnSellProperty.disabled = propertyDown <= 0;
      if (btnSellProperty.disabled) {
        btnSellProperty.classList.add('btn-disabled');
        btnSellProperty.title = 'Keine Immobilien zum Verkaufen vorhanden';
      } else {
        btnSellProperty.classList.remove('btn-disabled');
        btnSellProperty.title = 'Immobilien verkaufen';
      }
    }
      function setupSellButtons() {
      // Verkauf-Buttons mit den Popup-Funktionen
      document.getElementById('btn-sell-metals').addEventListener('click', () => {
        const metalsAmount = parseInt(document.getElementById('input-asset-metals').value) || 0;
        if (metalsAmount > 0) {
          showMetalsSellPopup();
        }
      });
      
      document.getElementById('btn-sell-stocks').addEventListener('click', () => {
        const stocksQty = parseInt(document.getElementById('input-asset-stocks-qty').value) || 0;
        if (stocksQty > 0) {
          // Funktion f√ºr den Verkauf (kann sp√§ter implementiert werden)
          alert('Verkauf-Funktion f√ºr Aktien wird noch implementiert.');
        }
      });
      
      document.getElementById('btn-sell-property').addEventListener('click', () => {
        const propertyDown = parseInt(document.getElementById('input-asset-property-down').value) || 0;
        if (propertyDown > 0) {
          // Funktion f√ºr den Verkauf (kann sp√§ter implementiert werden)
          alert('Verkauf-Funktion f√ºr Immobilien wird noch implementiert.');
        }
      });
      
      // Setup f√ºr das Edelmetalle-Verkauf-Popup
      setupMetalsSellPopup();
    }
    
    function setupMetalsSellPopup() {
      const popup = document.getElementById('metals-sell-popup');
      const sellTypeSelect = document.getElementById('metals-sell-type');
      const coinsInput = document.getElementById('metals-sell-coins');
      const priceInput = document.getElementById('metals-sell-price');
      const totalContainer = document.getElementById('metals-sell-total-container');
      const totalPrice = document.getElementById('metals-sell-total-price');
      const confirmBtn = document.getElementById('metals-sell-confirm');
      const cancelBtn = document.getElementById('metals-sell-cancel');
      
      // Verkaufsart-Wechsel
      sellTypeSelect.addEventListener('change', updateMetalsSellPriceCalculation);
      
      // Input-√Ñnderungen
      coinsInput.addEventListener('input', updateMetalsSellPriceCalculation);
      priceInput.addEventListener('input', updateMetalsSellPriceCalculation);
      
      // Buttons
      confirmBtn.addEventListener('click', () => {
        const totalMetals = parseInt(document.getElementById('input-asset-metals').value) || 0;
        const coinsToSell = parseInt(coinsInput.value) || 0;
        let price;
        
        if (sellTypeSelect.value === 'total') {
          price = parseFloat(priceInput.value) || 0;
        } else {
          price = (parseFloat(priceInput.value) || 0) * coinsToSell;
        }
        
        // Pr√ºfen, ob gen√ºgend M√ºnzen vorhanden sind und der Preis g√ºltig ist
        if (coinsToSell > 0 && price > 0 && coinsToSell <= totalMetals) {
          // Erl√∂s zum Kontostand hinzuf√ºgen
          runningBalance += price;
          
          // Anzahl der M√ºnzen von den Edelmetallen abziehen
          document.getElementById('input-asset-metals').value = totalMetals - coinsToSell;
          
          // Kontostandanzeige aktualisieren
          addMetalsSaleToEntries(coinsToSell, price);
          updateDisplayBalance();
          
          // Popup schlie√üen
          hideMetalsSellPopup();
        } else {
          // Fehlermeldung bei unzureichenden M√ºnzen oder ung√ºltigen Werten
          if (coinsToSell > totalMetals) {
            alert('Sie besitzen nicht gen√ºgend M√ºnzen f√ºr diesen Verkauf!');
          } else {
            alert('Bitte geben Sie g√ºltige Werte ein!');
          }
        }
      });
      
      cancelBtn.addEventListener('click', hideMetalsSellPopup);
      
      // Klick au√üerhalb des Popups schlie√üt es
      popup.addEventListener('click', (e) => {
        if (e.target === popup) {
          hideMetalsSellPopup();
        }
      });
    }
    
    function updateMetalsSellPriceCalculation() {
      const sellTypeSelect = document.getElementById('metals-sell-type');
      const coinsInput = document.getElementById('metals-sell-coins');
      const priceInput = document.getElementById('metals-sell-price');
      const totalContainer = document.getElementById('metals-sell-total-container');
      const totalPrice = document.getElementById('metals-sell-total-price');
      
      const coins = parseInt(coinsInput.value) || 0;
      const inputPrice = parseFloat(priceInput.value) || 0;
      
      if (sellTypeSelect.value === 'total') {
        // Gesamtpreis ausgew√§hlt
        priceInput.placeholder = 'Gesamterl√∂s';
        totalContainer.style.display = 'none';
      } else {
        // Preis pro M√ºnze ausgew√§hlt
        priceInput.placeholder = 'Preis pro M√ºnze';
        totalContainer.style.display = 'contents';
        totalPrice.textContent = (inputPrice * coins).toFixed(2) + " ‚Ç¨";
      }
    }
    
    function showMetalsSellPopup() {
      const totalMetals = parseInt(document.getElementById('input-asset-metals').value) || 0;
      
      // Popup zur√ºcksetzen und anzeigen
      document.getElementById('metals-sell-type').value = 'total';
      document.getElementById('metals-sell-coins').value = '1';
      document.getElementById('metals-sell-price').value = '';
      document.getElementById('metals-sell-price').placeholder = 'Gesamterl√∂s';
      document.getElementById('metals-sell-total-container').style.display = 'none';
      document.getElementById('metals-available').textContent = totalMetals;
      
      // Max-Wert f√ºr die Coin-Anzahl setzen
      document.getElementById('metals-sell-coins').max = totalMetals;
      
      const popup = document.getElementById('metals-sell-popup');
      popup.style.display = 'flex';
    }
    
    function hideMetalsSellPopup() {
      document.getElementById('metals-sell-popup').style.display = 'none';
    }
    
    function addMetalsSaleToEntries(coins, price) {
      const ul = document.getElementById('entries');
      const entriesChildren = Array.from(ul.children);
      const lastEntryIndex = entriesChildren.length - 1;
      
      // Pr√ºfen, ob das letzte Element ein leeres Eingabefeld ist
      const isLastEntryEmpty = lastEntryIndex >= 0 && 
                            entriesChildren[lastEntryIndex].querySelector('input').type === 'number';
      
      const insertBeforeElement = isLastEntryEmpty ? entriesChildren[lastEntryIndex] : null;
      
      // Eintrag f√ºr den Edelmetallverkauf erstellen
      const li = document.createElement('li');
      const inp = document.createElement('input');
      inp.type = 'text';
      inp.readOnly = true;
      inp.value = '+' + price.toFixed(2);
      inp.style.color = ''; // Positive Betr√§ge in Standardfarbe
      inp.title = `${coins} Edelmetall-M√ºnze${coins > 1 ? 'n' : ''} verkauft`;
      
      li.append(inp);
      
      if (insertBeforeElement) {
        ul.insertBefore(li, insertBeforeElement);
      } else {
        ul.appendChild(li);
      }
      
      // Aktualisierte Kontostandsanzeige
      const sumLi = document.createElement('li');
      const sumInp = document.createElement('input');
      sumInp.type = 'text';
      sumInp.readOnly = true;
      sumInp.value = (runningBalance >= 0 ? '+' : '-') + Math.abs(runningBalance).toFixed(2);
      sumInp.style.background = '#eee';
      
      if (runningBalance < 0) {
        sumInp.style.color = 'var(--danger)';
      }
      
      sumLi.append(sumInp);
      
      if (insertBeforeElement) {
        ul.insertBefore(sumLi, insertBeforeElement);
      } else {
        ul.appendChild(sumLi);
      }
      
      // Globale Flag setzen (f√ºr die Bank-Logik)
      window.lastActionWasManualEntry = true;
    }

function setupBankLoanButtons() {
      // Tracking-Variable f√ºr die aktuelle Sequenz von Bankkrediten
      let currentBankEntryAmount = 0;
      let currentBankEntryElement = null;

      // Flag, um zu pr√ºfen, ob seit der letzten Bankkredit-Aktualisierung eine manuelle Eingabe erfolgt ist
      window.lastActionWasManualEntry = false;

      // Knopf zum Abbezahlen von 1000 Euro
      document.getElementById('btn-pay-bank-1000').addEventListener('click', () => {
        const loanInput = document.getElementById('input-liability-bank');
        const loanAmount = parseFloat(loanInput.value) || 0;

        if (loanAmount >= 1000 && runningBalance >= 1000) {
          // Kredit um 1000 reduzieren
          const newLoanAmount = loanAmount - 1000;
          loanInput.value = newLoanAmount;

          // Kontostand anpassen
          runningBalance -= 1000;

          // Zinszahlung anpassen (10% des neuen Betrags)
          const newPayment = Math.round(newLoanAmount * 0.1);
          document.getElementById('input-expenses-bank').value = newPayment;

          // Kontostandanzeige im Bargeldkonto aktualisieren
          updateBankEntryInList(-1000);

          // Nach Bankkredit-Aktion Flag zur√ºcksetzen
          window.lastActionWasManualEntry = false;

          // Oberfl√§che aktualisieren
          updateDisplayBalance();
          updateSummary();
          updatePayButtonStates();
        }
      });

      // Knopf zum Aufnehmen von 1000 Euro
      document.getElementById('btn-take-bank-1000').addEventListener('click', () => {
        const loanInput = document.getElementById('input-liability-bank');
        const loanAmount = parseFloat(loanInput.value) || 0;

        // Kredit um 1000 erh√∂hen
        const newLoanAmount = loanAmount + 1000;
        loanInput.value = newLoanAmount;

        // Kontostand anpassen
        runningBalance += 1000;

        // Zinszahlung anpassen (10% des neuen Betrags)
        const newPayment = Math.round(newLoanAmount * 0.1);
        document.getElementById('input-expenses-bank').value = newPayment;

        // Kontostandanzeige im Bargeldkonto aktualisieren
        updateBankEntryInList(1000);

        // Nach Bankkredit-Aktion Flag zur√ºcksetzen
        window.lastActionWasManualEntry = false;

        // Oberfl√§che aktualisieren
        updateDisplayBalance();
        updateSummary();
      });        // Funktion zum Aktualisieren des Bankkredit-Eintrags in der Liste
      function updateBankEntryInList(amount) {
        const ul = document.getElementById('entries');
        const entriesChildren = Array.from(ul.children);
        const lastEntryIndex = entriesChildren.length - 1;

        // Zuerst check, ob wir ein leeres Eingabefeld am Ende haben
        const isLastEntryEmpty = lastEntryIndex >= 0 &&
          entriesChildren[lastEntryIndex].querySelector('input').type === 'number';

        // Wenn die letzte Aktion eine manuelle Eingabe war, erstellen wir immer einen neuen Eintrag
        if (window.lastActionWasManualEntry) {
          // Neuen Eintrag f√ºr die Bankkredit-√Ñnderung erstellen
          currentBankEntryAmount = amount;
          createNewBankEntry(amount, isLastEntryEmpty ? entriesChildren[lastEntryIndex] : null);
          return;
        }

        // Pr√ºfen, ob ein bestehender Bankkredit-Eintrag existiert (√ºberpr√ºfen der letzten Eintr√§ge)
        // Wir suchen in umgekehrter Reihenfolge, beginnend mit dem letzten nicht-leeren Eintrag
        let bankCreditEntryIndex = -1;

        // Wir starten die Suche beim vorletzten oder letzten Element (je nach leerem Feld am Ende)
        const startIndex = isLastEntryEmpty ? lastEntryIndex - 1 : lastEntryIndex;

        // Suche nach dem letzten Bankkredit-Eintrag
        for (let i = startIndex; i >= 0; i--) {
          const input = entriesChildren[i].querySelector('input');
          if (input && input.dataset.bankCredit === 'true') {
            bankCreditEntryIndex = i;
            break;
          }
        }

        // Fall 1: Es gibt einen existierenden Bankkredit-Eintrag
        if (bankCreditEntryIndex >= 0) {
          const bankCreditEntry = entriesChildren[bankCreditEntryIndex].querySelector('input');

          // Aktualisiere den Wert des bestehenden Eintrags
          currentBankEntryAmount = parseInt(bankCreditEntry.value.replace(/[+\-]/g, '')) * (bankCreditEntry.value.startsWith('-') ? -1 : 1);
          currentBankEntryAmount += amount;

          bankCreditEntry.value = (currentBankEntryAmount >= 0 ? '+' : '-') + Math.abs(currentBankEntryAmount);

          if (currentBankEntryAmount < 0) {
            bankCreditEntry.style.color = 'var(--danger)';
          } else {
            bankCreditEntry.style.color = '';
          }

          // Finde den zugeh√∂rigen Kontostand-Eintrag (sollte direkt danach kommen)
          if (bankCreditEntryIndex + 1 < entriesChildren.length) {
            const balanceEntry = entriesChildren[bankCreditEntryIndex + 1].querySelector('input');
            if (balanceEntry && balanceEntry.style.background === '#eee') {
              balanceEntry.value = (runningBalance >= 0 ? '+' : '-') + Math.abs(runningBalance);

              if (runningBalance < 0) {
                balanceEntry.style.color = 'var(--danger)';
              } else {
                balanceEntry.style.color = '';
              }
            }
          }

          return;
        }

        // Fall 2: Es gibt keinen existierenden Bankkredit-Eintrag, also erstellen wir einen neuen
        currentBankEntryAmount = amount;
        createNewBankEntry(amount, isLastEntryEmpty ? entriesChildren[lastEntryIndex] : null);
      }

      // Hilfsfunktion zum Erstellen eines neuen Bankkredit-Eintrags
      function createNewBankEntry(amount, insertBeforeElement) {
        const ul = document.getElementById('entries');

        // Neuen Eintrag f√ºr die Bankkredit-√Ñnderung erstellen
        const li = document.createElement('li');
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.readOnly = true;
        inp.value = (amount >= 0 ? '+' : '-') + Math.abs(amount);
        inp.dataset.bankCredit = 'true'; // Markiere als Bankkredit-Eintrag

        if (amount < 0) {
          inp.style.color = 'var(--danger)';
        }

        li.append(inp);

        if (insertBeforeElement) {
          // Einf√ºgen vor dem leeren Eingabefeld
          ul.insertBefore(li, insertBeforeElement);
        } else {
          // Anf√ºgen am Ende, wenn kein leeres Eingabefeld vorhanden ist
          ul.appendChild(li);
        }

        // Aktualisiere den Kontostand-Eintrag
        const sumLi = document.createElement('li');
        const sumInp = document.createElement('input');
        sumInp.type = 'text';
        sumInp.readOnly = true;
        sumInp.value = (runningBalance >= 0 ? '+' : '-') + Math.abs(runningBalance);
        sumInp.style.background = '#eee';

        if (runningBalance < 0) {
          sumInp.style.color = 'var(--danger)';
        }

        sumLi.append(sumInp);

        if (insertBeforeElement) {
          // Einf√ºgen nach dem Bankkredit-Eintrag und vor dem leeren Eingabefeld
          ul.insertBefore(sumLi, insertBeforeElement);
        } else {
          // Anf√ºgen am Ende
          ul.appendChild(sumLi);
        }

        // Aktuelle Elemente f√ºr sp√§tere Aktualisierungen speichern
        currentBankEntryElement = inp;      }
    }
    
    // Mobile scroll functionality for hiding taskbar
    function setupMobileScroll() {
      // Only set up on mobile devices
      if (window.innerWidth > 768) {
        return;
      }
      
      const body = document.body;
      let touchStartY = 0;
      let touchEndY = 0;
      
      // Handle for showing taskbar again
      const mobileHandle = document.getElementById('mobile-handle');
      mobileHandle.addEventListener('click', () => {
        body.classList.remove('taskbar-hidden');
      });
      
      // Touch events for the whole page
      body.addEventListener('touchstart', (e) => {
        touchStartY = e.touches[0].clientY;
      }, false);
      
      body.addEventListener('touchend', (e) => {
        touchEndY = e.changedTouches[0].clientY;
        handleSwipe();
      }, false);
      
      function handleSwipe() {
        // Detect direction
        const swipeDistance = touchEndY - touchStartY;
        
        // Upward swipe (hide taskbar)
        if (swipeDistance < -50 && !body.classList.contains('taskbar-hidden')) {
          body.classList.add('taskbar-hidden');
        }
        
        // Downward swipe (show taskbar)
        if (swipeDistance > 50 && body.classList.contains('taskbar-hidden')) {
          body.classList.remove('taskbar-hidden');
        }
      }
    }
    
    // Initialize mobile scroll when page loads
    document.addEventListener('DOMContentLoaded', function() {
      setupMobileScroll();
    });
  </script>
</body>

</html>